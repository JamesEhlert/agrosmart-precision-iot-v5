; PlatformIO Project Configuration File
; Project: AgroSmart Precision System V5 (Firmware)
; Hardware: ESP32-WROOM-32 (DevKit V1)

[platformio]
; Troque aqui rapidamente entre prod e stress
default_envs = esp32doit-devkit-v1_stress

; ----------------------------
; Config compartilhada
; ----------------------------
[common]
; Flags globais (tanto prod quanto stress)
build_flags =
  -D FW_VERSION=\"5.17.2\"
  ; Se quiser padronizar um schema de telemetria:
  -D TELEMETRY_SCHEMA_VERSION=1

  ; Se o seu código já usa essas flags (ou se você vai usar nos próximos upgrades)
  ; (mantém o platformio pronto pro futuro sem precisar mexer toda hora)
  -D ENABLE_SD_QUEUE_ROTATION=1
  -D SD_QUEUE_SEGMENT_MAX_BYTES=131072
  -D SD_QUEUE_MAX_SEGMENTS=32

  ; Logs (0=quiet, 1=normal, 2=debug)
  -D LOG_LEVEL=1

; ----------------------------
; Ambiente PROD (campo / bateria)
; ----------------------------
[env:esp32doit-devkit-v1_prod]
platform = espressif32
board = esp32doit-devkit-v1
framework = arduino
monitor_speed = 115200

; Dica: filtros de monitor ajudam MUITO a debugar
monitor_filters = time, colorize, esp32_exception_decoder

lib_deps =
    adafruit/Adafruit AHTX0 @ ^2.0.5
    adafruit/Adafruit Unified Sensor @ ^1.1.15
    adafruit/Adafruit BusIO @ ^1.17.4
    adafruit/RTClib @ ^2.1.4
    adafruit/Adafruit GFX Library @ ^1.12.4
    adafruit/Adafruit SSD1306 @ ^2.5.16
    knolleary/PubSubClient @ ^2.8
    bblanchon/ArduinoJson @ ^6.21.5

build_flags =
  ${common.build_flags}
  -D DEFAULT_TELEMETRY_INTERVAL_MS=1800000  ; 30 min
  -D ENABLE_OLED=0                         ; campo: desligado

; ----------------------------
; Ambiente STRESS (teste de fila offline)
; ----------------------------
[env:esp32doit-devkit-v1_stress]
platform = espressif32
board = esp32doit-devkit-v1
framework = arduino
monitor_speed = 115200
monitor_filters = time, colorize, esp32_exception_decoder

lib_deps =
    ${env:esp32doit-devkit-v1_prod.lib_deps}

build_flags =
  ${common.build_flags}
  -D DEFAULT_TELEMETRY_INTERVAL_MS=10000   ; 10s (troque pra 20000 se quiser)
  -D ENABLE_OLED=1
  -D LOG_LEVEL=2
